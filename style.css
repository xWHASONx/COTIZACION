:root {
    --c-blue: #23C3E8; --c-dark-blue: #293241; --c-dark: #1d1d1f; --c-gray: #5f5f63; --c-light-gray: #f0f2f5; --c-mid-gray: #e9ecef; --c-white: #fff; --c-success-green: #3DCA8A;
}
body { margin: 0; padding: 0; font-family: 'Poppins', sans-serif; background-color: var(--c-light-gray); color: var(--c-dark); -webkit-font-smoothing: antialiased; }
.wrapper { max-width: 800px; margin: 40px auto; background-color: var(--c-white); box-shadow: 0 20px 70px rgba(0,0,0,0.1); border-radius: 24px; overflow: hidden; }
#loader-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 1000; flex-direction: column; color: var(--c-white); }
.spinner { border: 8px solid var(--c-light-gray); border-top: 8px solid var(--c-blue); border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; margin-bottom: 20px; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.header { background-color: var(--c-white); padding: 30px; text-align: center; border-bottom: 1px solid #dee2e6; }
.header img { max-width: 400px; height: auto; }
.section { padding: 40px; text-align: center; }
h1, h2, h3, h4 { font-weight: 700; line-height: 1.2; margin:0; }
h1 { font-size: 40px; margin-bottom: 10px; }
.intro-text { font-size: 18px; color: var(--c-gray); max-width: 600px; margin: 0 auto 25px auto; }
#form-section { padding-top: 0; }
form { margin-top: 20px; text-align: left; }
.form-fieldset { border: 1px solid #ddd; border-radius: 12px; padding: 25px; margin-bottom: 5px; position: relative; }
.form-fieldset legend { font-weight: 700; font-size: 18px; padding: 0 10px; color: var(--c-dark-blue); }
.sub-fieldset { border: 1px dashed #ccc; border-radius: 8px; padding: 20px; margin-top: 10px; position: relative; }
.sub-fieldset > label { font-weight: 600; font-size: 15px; margin-bottom: 15px; display: block; }
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.form-grid.small-gap { gap: 15px; }
.form-grid.four-cols { grid-template-columns: 1fr 1fr 1fr 1fr; }
.form-group { display: flex; flex-direction: column; position: relative; }
.form-group.full-width { grid-column: 1 / -1; }
.form-group label { font-weight: 600; font-size: 14px; margin-bottom: 8px; }
.form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid #ddd; font-family: 'Poppins', sans-serif; font-size: 16px; box-sizing: border-box; transition: border-color 0.2s, box-shadow 0.2s; }
.form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: var(--c-blue); box-shadow: 0 0 0 3px rgba(35, 195, 232, 0.2); }
input[readonly] { background-color: #f0f2f5; cursor: not-allowed; }
.currency-group { display: flex; gap: 10px; }
.currency-group input { flex-grow: 1; }
.currency-group select { width: 100px; }
.submit-button { display: inline-block; width: 100%; background-color: var(--c-blue); color: var(--c-white); padding: 16px; border-radius: 12px; font-size: 18px; font-weight: 700; border: none; cursor: pointer; margin-top: 30px; transition: background-color 0.2s; }
.submit-button:hover { background-color: #1fa7c7; }
.add-buttons-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px; padding: 20px; background-color: #f7f9fc; border-radius: 12px; }
.add-section-btn, .add-subsection-btn { flex-grow: 1; display: block; text-align: center; background-color: var(--c-white); border: 1px dashed #a8b9c7; color: var(--c-dark-blue); font-weight: 600; padding: 12px; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
.add-section-btn:hover, .add-subsection-btn:hover { background-color: #e1e8f2; border-color: #3a506b; }
.add-subsection-btn { grid-column: 1 / -1; margin-top: 10px; }
.dynamic-section-wrapper { margin-bottom: 20px; }
.remove-section-btn { position: absolute; top: 10px; right: 10px; background-color: #fcebeb; color: #c53030; border: 1px solid #f9bdbb; width: 30px; height: 30px; border-radius: 50%; font-size: 20px; line-height: 28px; text-align: center; cursor: pointer; font-weight: bold; transition: all 0.2s; }
.remove-section-btn:hover { background-color: #c53030; color: white; transform: scale(1.1); }
.paste-area { border: 2px dashed #ccc; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; background-color: #fdfdfd; min-height: 100px; display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden; }
.paste-area:hover { border-color: var(--c-blue); background-color: #f7fcff; }
.paste-area p { color: #aaa; font-weight: 500; margin: 0; }
.paste-area img { max-width: 100%; max-height: 150px; border-radius: 8px; object-fit: cover; }
.gallery-paste-areas { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
.gallery-paste-areas .paste-area { min-height: 150px; }
.gallery-paste-areas img { width: 100%; height: 100%; }
#confirmation-section { padding-bottom: 40px; }
.confirmation-header { background-image: url('https://i.imgur.com/7Izn0Vp.png'); background-size: cover; background-position: center; padding: 30px; text-align: center; }
.confirmation-header img { max-width: 350px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4)); }
.voucher-content { padding: 30px; text-align: center; }
.confirmation-title-image { display: block; margin: 0 auto 25px auto; max-width: 400px; width: 100%; height: auto; }
.customer-data-box { background-color: var(--c-light-gray); padding: 20px; border-radius: 16px; margin-bottom: 25px; text-align: left; }
.customer-data-box p { margin: 0 0 8px 0; font-size: 14px; color: var(--c-gray); }
.customer-data-box p:last-child { margin-bottom: 0; }
.customer-data-box strong { color: var(--c-dark-blue); font-weight: 700; font-size: 16px; }
#advisor-box { display: flex; align-items: center; gap: 20px; background-color: #f7f9fc; border: 1px solid #e1e8f2; padding: 20px; border-radius: 16px; text-align: left; }
#advisor-photo { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 4px solid var(--c-white); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
.advisor-info { flex-grow: 1; }
.advisor-info p { margin: 0 0 5px 0; font-size: 14px; color: var(--c-gray); }
.advisor-info h3 { font-size: 22px; color: var(--c-dark-blue); }
.advisor-contact { display: flex; }
.single-contact-btn { background-color: var(--c-success-green); color: var(--c-white); padding: 10px 25px; text-decoration: none; font-weight: 700; border-radius: 8px; transition: all 0.2s; }
.single-contact-btn:hover { background-color: #2fb573; }
.quote-option-box { border: 1px solid #ddd; border-radius: 16px; margin-top: 25px; overflow: hidden; text-align: left; }
.option-header { display: flex; justify-content: space-between; align-items: center; background-color: var(--c-dark-blue); color: var(--c-white); padding: 20px 25px; }
.option-header h3 { font-size: 20px; color: var(--c-blue); }
.option-price { font-size: 24px; font-weight: 900; }
.option-body { padding: 25px; }
.option-body h4 { font-size: 26px; font-weight: 900; margin-bottom: 20px; color: var(--c-dark); }
.photo-gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 25px; }
.photo-gallery img { width: 100%; height: 150px; object-fit: cover; border-radius: 12px; }
.single-photo-container img { width: 100%; height: auto; max-height: 250px; object-fit: cover; border-radius: 12px; margin-bottom: 25px; }
.details-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
.data-item { display: flex; align-items: flex-start; gap: 15px; }
.details-grid .data-item { padding-bottom: 0; }
.data-item.full-width { grid-column: 1 / -1; margin-top: 10px; }
.data-item svg { width: 24px; height: 24px; color: var(--c-blue); flex-shrink: 0; margin-top: 2px; }
.data-item-content strong { display: block; font-size: 14px; color: var(--c-gray); margin-bottom: 5px; text-transform: uppercase; }
.data-item-content p { font-size: 16px; font-weight: 600; margin: 0; white-space: pre-wrap; word-wrap: break-word; }
.component-section { border: 1px solid #ddd; border-radius: 16px; margin-top: 25px; overflow: hidden; text-align: left; }
.component-section h3 { background-color: var(--c-dark-blue); color: var(--c-blue); padding: 20px 25px; font-size: 20px; }
#flight-options-confirm-container, #tour-options-confirm-container, #transfer-options-confirm-container { padding: 25px; }
.item-option { display: flex; justify-content: space-between; align-items: center; font-size: 16px; padding: 15px; border-radius: 8px; background-color: var(--c-light-gray); margin-bottom: 10px; }
.item-option:last-child { margin-bottom: 0; }
.item-price { font-weight: 900; color: var(--c-dark-blue); }
.item-disclaimer { font-size: 12px; color: var(--c-gray); padding: 0 25px 20px 25px; text-align: center; }
.details-section { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 25px; text-align: left; }
.payment-plan-box, .inclusions-box { background-color: var(--c-light-gray); padding: 25px; border-radius: 16px; }
.payment-plan-box h4, .inclusions-box h4 { font-size: 18px; color: var(--c-dark-blue); margin-bottom: 15px; }
.payment-plan-box p { font-size: 15px; margin: 0 0 10px 0; }
.payment-plan-box p strong { color: var(--c-dark); }
.payment-plan-box small { font-size: 13px; color: var(--c-gray); }
.inclusions-box p { white-space: pre-wrap; font-size: 14px; color: var(--c-gray); line-height: 1.6; margin-top: 5px; }
.terms-content-body { padding: 25px; text-align: left; font-size: 13px; color: var(--c-gray); line-height: 1.6; }
.terms-content-body h3 { font-size: 16px; color: var(--c-dark-blue); margin-top: 20px; margin-bottom: 10px; }
.terms-content-body h3:first-child { margin-top: 0; }
.terms-content-body ul { padding-left: 20px; margin: 0 0 15px 0; }
.terms-content-body li { margin-bottom: 8px; }
.main-cta-container { text-align: center; padding: 30px; margin-top: 25px; background-color: #f7f9fc; border: 1px solid #e1e8f2; }
.main-cta-container h3 { font-size: 24px; margin-bottom: 20px; color: var(--c-dark-blue); }
.main-cta-button { display: block; text-decoration: none; color: var(--c-white); padding: 18px; border-radius: 12px; font-size: 20px; font-weight: 700; transition: all 0.2s ease; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 0.5px; }
.main-cta-button.reserve { background-color: var(--c-blue); }
.main-cta-button.reserve:hover { background-color: #1fa7c7; transform: translateY(-3px); box-shadow: 0 8px 20px rgba(35, 195, 232, 0.3); }
.main-cta-button.contact { background-color: var(--c-gray); font-size: 16px; padding: 12px; }
.main-cta-button.contact:hover { background-color: #4a4a4e; }
.voucher-footer { padding: 30px 20px; text-align: center; }
.airline-logos { display: flex; justify-content: center; align-items: center; gap: 25px; flex-wrap: wrap; margin-bottom: 25px; }
.airline-logos img { max-height: 40px; width: auto; opacity: 0.8; }
.action-buttons { margin-top: 40px; display: flex; gap: 15px; justify-content: center; padding: 0 20px; }
.action-button { display: inline-flex; align-items: center; justify-content: center; gap: 10px; padding: 16px 30px; border-radius: 12px; font-size: 18px; font-weight: 700; border: none; cursor: pointer; transition: background-color 0.2s, box-shadow 0.2s; flex-grow: 1; }
.action-button.download { background-color: var(--c-blue); color: var(--c-white); }
.action-button.download:hover { background-color: #1fa7c7; }
.action-button.download:disabled { background-color: #9ddff0; cursor: not-allowed; }
.action-button.secondary { background-color: var(--c-mid-gray); color: var(--c-dark-blue); }
.action-button.secondary:hover { background-color: #d1d5da; }
@media (max-width: 768px) {
    .wrapper { margin: 0; border-radius: 0; }
    .section, .voucher-content { padding: 30px 20px; }
    .form-grid, .gallery-paste-areas, .details-section, .add-buttons-container, .details-grid { grid-template-columns: 1fr; }
    #advisor-box, .customer-data-box { flex-direction: column; text-align: center; }
    .advisor-contact { flex-direction: row; }
    .action-buttons { flex-direction: column; }
}
.inclusions-box p {
    white-space: pre-wrap; /* <-- ESTA ES LA L칈NEA CLAVE */
    font-size: 14px;
    color: var(--c-gray);
    line-height: 1.6;
    margin-top: 5px;
}
.payment-plan-box small {
    white-space: pre-wrap; /* <-- ASEG칔RATE DE QUE ESTA L칈NEA EST칄 PRESENTE */
    font-size: 13px;
    color: var(--c-gray);
}
/* ===== ESTILOS PARA LA PANTALLA DE LOGIN ===== */
#login-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--c-light-gray);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
}

#login-box {
    background-color: var(--c-white);
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    text-align: center;
    max-width: 400px;
    width: 90%;
}

.login-logo {
    max-width: 250px;
    margin-bottom: 20px;
}

#login-box h2 {
    font-size: 24px;
    color: var(--c-dark-blue);
    margin-bottom: 10px;
}

#login-box p {
    color: var(--c-gray);
    margin-bottom: 25px;
}

#login-form input {
    width: 100%;
    padding: 14px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-family: 'Poppins', sans-serif;
    font-size: 16px;
    box-sizing: border-box;
    text-align: center;
}

#login-form button {
    width: 100%;
    background-color: var(--c-blue);
    color: var(--c-white);
    padding: 14px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 700;
    border: none;
    cursor: pointer;
    margin-top: 15px;
    transition: background-color 0.2s;
}

#login-form button:hover {
    background-color: #1fa7c7;
}

/* Ocultar el contenido principal por defecto */
.wrapper {
    display: none;
}```

---

### **Paso 3: Modificar `script.js` (La Versi칩n Correcta)**

**Objetivo:** A침adir la l칩gica de contrase침a de forma que no cause errores.

**Acci칩n:**
Para evitar cualquier error, te dar칠 el archivo `script.js` completo, ya modificado. **Reemplaza TODO el contenido de tu `script.js` con el siguiente c칩digo.**

```javascript
document.addEventListener('DOMContentLoaded', () => {

    // --- CONFIGURACI칍N DE ACCESO ---
    const ACCESS_PASSWORD = 'tu_contrase침a_secreta'; // <-- CAMBIA ESTO

    // --- ELEMENTOS DEL LOGIN ---
    const loginOverlay = document.getElementById('login-overlay');
    const loginForm = document.getElementById('login-form');
    const passwordInput = document.getElementById('password-input');
    const loginError = document.getElementById('login-error');
    const mainWrapper = document.querySelector('.wrapper');

    // --- FUNCI칍N PRINCIPAL DE LA APP ---
    function initializeApp() {
        
        // --- 1. CONFIGURACI칍N GLOBAL ---
        const ADVISORS = {
            'katherine_rueda': { name: 'Katherine Rueda', photoUrl: 'https://i.imgur.com/21GKFPV.png', defaultWhatsapp: '573249450254' },
            'yonder_gonzalez': { name: 'Yonder Gonzalez', photoUrl: 'https://i.imgur.com/IPWYtIU.jpeg', defaultWhatsapp: '573508917512' },
            'juan_madrid': { name: 'Juan David Madrid', photoUrl: 'https://i.imgur.com/Oanbam8.jpeg', defaultWhatsapp: '573145352537' },
            'valentina_herrera': { name: 'Valentina Herrera', photoUrl: 'https://i.imgur.com/MHGZASr.png', defaultWhatsapp: '573184188621' },
            'maryory_gonzalez': { name: 'Maryory Gonzalez', photoUrl: 'https://i.imgur.com/G9nHKlg.jpeg', defaultWhatsapp: '573189150322' },
            'margareth_saucedo': { name: 'Margareth Saucedo', photoUrl: 'https://i.imgur.com/peBTIni.jpeg', defaultWhatsapp: '573502687290' },
            'karen_giraldo': { name: 'Karen Giraldo', photoUrl: 'https://i.imgur.com/Amn1Wtb.jpeg', defaultWhatsapp: '573216839241' },
            'sofia_giraldo': { name: 'Sofia Giraldo', photoUrl: 'https://i.imgur.com/GMOLJxa.jpeg', defaultWhatsapp: '573113854751' },
            'nicol_tamayo': { name: 'Nicol Tamayo', photoUrl: 'https://i.imgur.com/7pg3HvF.jpeg', defaultWhatsapp: '' },
            'daniela_cardona': { name: 'Daniela Cardona', photoUrl: 'https://i.imgur.com/dwnDmHy.png', defaultWhatsapp: '' },
            'sarah_esteves': { name: 'Sarah George Esteves', photoUrl: 'https://i.imgur.com/mt1UKBS.jpeg', defaultWhatsapp: '573226817507' },
            'Carolina_Mu침oz': { name: 'Carolina Mu침oz', photoUrl: 'https://i.imgur.com/sXnamkJ.jpeg', defaultWhatsapp: '573113855927' }
        };

        const ICONS = {
            destination: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>',
            calendar: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>',
            moon: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>',
            bed: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7h2a2 2 0 012 2v9a2 2 0 01-2 2h-2m-6 0H7a2 2 0 01-2-2V9a2 2 0 012-2h2m4-4h2a2 2 0 012 2v2H9V5a2 2 0 012-2zM9 12h6"></path></svg>',
            check: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>',
            plane: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>'
        };

        const TERMS_AND_CONDITIONS = {
            flights: `
                <h3>九걾잺 Tiquetes A칠reos</h3>
                <ul>
                    <li>Los valores e itinerarios cotizados est치n sujetos a cambios y disponibilidad por parte de las aerol칤neas sin previo aviso.</li>
                    <li>Los vuelos incluidos en esta cotizaci칩n son aproximados al momento de su emisi칩n.</li>
                    <li>Para garantizar el valor y el itinerario proporcionado, se debe realizar el <strong>pago total inmediato</strong>.</li>
                    <li>Ninguna aerol칤nea permite separar, reservar o congelar precios sin el pago completo.</li>
                    <li>En caso de cambio de fecha, nombre del pasajero o cualquier modificaci칩n, la aerol칤nea aplicar치 penalidades seg칰n su pol칤tica interna.</li>
                    <li>Ni침os mayores de 2 a침os cumplidos pagan tarifa de adulto.</li>
                    <li>Los tiquetes se emiten en tarifa b치sica, la cual incluye 칰nicamente un <strong>art칤culo personal</strong> (mochila o bolso peque침o). Si deseas adicionar equipaje de mano o de bodega, se podr치 incluir posteriormente o solicitar con anticipaci칩n. Ten en cuenta que esto genera un costo adicional.</li>
                </ul>
            `,
            hotels: `
                <h3>游낃 Hoteles</h3>
                <ul>
                    <li>La reserva hotelera se realiza inicialmente con un pago parcial (separaci칩n). El saldo restante deber치 estar completamente pagado al menos <strong>45 d칤as antes</strong> de la fecha del viaje.</li>
                    <li>Si deseas modificar la fecha del viaje, se validar치 primero la disponibilidad en el hotel. En caso de no estar disponible, se intentar치 mantener el valor en otro hotel de la misma categor칤a.</li>
                    <li>Si la nueva fecha corresponde a temporada alta y el valor se incrementa, el cliente deber치 asumir la diferencia.</li>
                    <li>Ni침os mayores de 6 a침os pagan estad칤a en la mayor칤a de hoteles, de acuerdo con sus pol칤ticas.</li>
                    <li>En caso de que la garant칤a de 12 meses no sea suficiente y desees extenderla hasta 18 meses, esta extensi칩n est치 sujeta a aprobaci칩n y puede implicar penalidades o ajustes de tarifa.</li>
                    <li>Se permite el cambio de titular de la reserva, siempre y cuando el titular actual lo autorice por escrito y el nuevo titular acepte los t칠rminos y condiciones vigentes.</li>
                    <li>Si decides cambiar de un destino internacional a uno nacional y el valor de la separaci칩n inicial supera $1.500.000 COP, este valor ser치 dividido para aplicar a dos destinos nacionales.</li>
                </ul>
            `,
            transfers: `
                <h3>游뚫 Traslados</h3>
                <ul>
                    <li>Si el plan incluye traslados desde el aeropuerto de Punta Cana al hotel en Punta Cana y posteriormente decides comprar vuelos con llegada a Santo Domingo, los traslados adicionales correr치n por cuenta del cliente. Esto debido a la diferencia de distancia entre ambas ciudades y el reajuste necesario en la log칤stica.</li>
                </ul>
            `
        };

        const REGIMEN_TEMPLATES = {
            'todo_incluido': `Alojamiento en habitaci칩n est치ndar.\nDesayunos, almuerzos y cenas tipo buffet.\nSnacks entre comidas.\nBebidas alcoh칩licas y no alcoh칩licas nacionales ilimitadas.`,
            'pension_completa': `Alojamiento en habitaci칩n est치ndar.\nDesayuno, almuerzo y cena.\nNo incluye bebidas en las comidas.`,
            'media_pension': `Alojamiento en habitaci칩n est치ndar.\nDesayuno y cena.\nNo incluye bebidas en la cena.`,
            'desayuno': `Alojamiento en habitaci칩n est치ndar.\nDesayuno tipo buffet.`,
            'solo_hotel': `Alojamiento en habitaci칩n est치ndar.\nNo incluye comidas ni bebidas.`
        };

        let pastedImages = {};
        let hotelCounter = 0;
        const form = document.getElementById('pre-reserva-form');
        const formTitleSection = document.getElementById('form-title-section');
        const formSection = document.getElementById('form-section');
        const confirmationSection = document.getElementById('confirmation-section');
        const processQuoteBtn = document.getElementById('process-quote-btn');
        const newQuoteBtn = document.getElementById('new-quote-btn');
        const loaderOverlay = document.getElementById('loader-overlay');
        const dynamicComponentsContainer = document.getElementById('dynamic-components-container');
        const confirmationComponentsContainer = document.getElementById('confirmation-components-container');
        const advisorSelect = document.getElementById('asesor');
        const advisorWhatsappInput = document.getElementById('whatsapp-asesor');

        const requiredFieldsConfig = {
            'flights': ['ciudad-salida', 'flight-1-airline', 'flight-1-price'],
            'tours': ['tour-1-name', 'tour-1-price'],
            'transfers': ['transfer-1-desc', 'transfer-1-price']
        };

        function addSection(sectionKey) {
            if (sectionKey === 'hotel') {
                hotelCounter++;
                const template = document.getElementById('template-hotel');
                if (!template) return;

                let cloneHtml = template.innerHTML.replace(/PLACEHOLDER/g, hotelCounter);
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = cloneHtml;
                const cloneNode = tempDiv.firstElementChild;

                dynamicComponentsContainer.appendChild(cloneNode);

                const nightsSelect = document.getElementById(`cantidad-noches-${hotelCounter}`);
                for (let i = 1; i <= 30; i++) {
                    const option = new Option(`${i} noche${i > 1 ? 's' : ''}`, i);
                    if (i === 4) option.selected = true;
                    nightsSelect.add(option);
                }
                const roomsSelect = document.getElementById(`cantidad-habitaciones-${hotelCounter}`);
                for (let i = 1; i <= 10; i++) {
                    const option = new Option(`${i} habitaci칩n${i > 1 ? 'es' : ''}`, i);
                    if (i === 1) option.selected = true;
                    roomsSelect.add(option);
                }
                
                addEventListenersToSection(cloneNode);
                
                if (hotelCounter === 1) {
                    document.querySelector(`.add-section-btn[data-section="hotel"]`).style.display = 'none';
                }
                if (hotelCounter > 1) {
                    document.querySelector(`#hotel-form-wrapper-${hotelCounter - 1} .add-subsection-btn`).style.display = 'none';
                }
            } else {
                const template = document.getElementById(`template-${sectionKey}`);
                if (!template) return;
                const clone = template.content.cloneNode(true);
                dynamicComponentsContainer.appendChild(clone);
                addEventListenersToSection(dynamicComponentsContainer.querySelector(`#${sectionKey}-form-wrapper`));
                document.querySelector(`.add-section-btn[data-section="${sectionKey}"]`).style.display = 'none';
                updateRequiredFields(sectionKey, true);
            }
        }

        function removeSection(sectionKey) {
            if (sectionKey.startsWith('hotel-')) {
                const wrapper = document.getElementById(`hotel-form-wrapper-${sectionKey.split('-')[1]}`);
                if (wrapper) {
                    wrapper.remove();
                    if (document.querySelectorAll('.hotel-form-wrapper').length === 0) {
                        document.querySelector(`.add-section-btn[data-section="hotel"]`).style.display = 'block';
                        hotelCounter = 0;
                    } else {
                        const lastHotel = Array.from(document.querySelectorAll('.hotel-form-wrapper')).pop();
                        lastHotel.querySelector('.add-subsection-btn').style.display = 'block';
                    }
                }
            } else {
                const originalWrapper = document.getElementById(`${sectionKey}-form-wrapper`);
                if (originalWrapper) {
                    originalWrapper.remove();
                    document.querySelector(`.add-section-btn[data-section="${sectionKey}"]`).style.display = 'block';
                    updateRequiredFields(sectionKey, false);
                }
            }
        }

        function addSubSection(subSectionKey) {
            if (subSectionKey === 'hotel') { // L칩gica para a침adir nuevo hotel
                 addSection('hotel');
            } else { // L칩gica antigua para subsecciones como flight-2
                const wrapper = document.getElementById(`${subSectionKey}-form-wrapper`);
                if (wrapper) {
                    wrapper.style.display = 'block';
                    document.querySelector(`.add-subsection-btn[data-subsection="${subSectionKey}"]`).style.display = 'none';
                    updateRequiredFields(subSectionKey, true);
                }
            }
        }
        
        function removeSubSection(subSectionKey) {
            const wrapper = document.getElementById(`${subSectionKey}-form-wrapper`);
            if (wrapper) {
                wrapper.style.display = 'none';
                wrapper.querySelectorAll('input').forEach(input => input.value = '');
                document.querySelector(`.add-subsection-btn[data-subsection="${subSectionKey}"]`).style.display = 'block';
                updateRequiredFields(subSectionKey, false);
            }
        }

        function updateRequiredFields(key, isRequired) {
            (requiredFieldsConfig[key] || []).forEach(id => {
                const el = document.getElementById(id);
                if (el) el.required = isRequired;
            });
        }
        
        form.addEventListener('click', e => {
            const { target } = e;
            const { section, subsection } = target.dataset;
            if (target.matches('.add-section-btn')) addSection(section);
            if (target.matches('.remove-section-btn')) removeSection(section);
            if (target.matches('.add-subsection-btn')) addSubSection(section || subsection);
            if (target.matches('.remove-section-btn[data-subsection]')) removeSubSection(subsection);
        });

        function handlePaste(e) {
            e.preventDefault();
            const pasteArea = e.currentTarget; const imageId = pasteArea.dataset.imgId;
            const item = Array.from(e.clipboardData.items).find(i => i.type.startsWith('image/'));
            if (item) {
                const reader = new FileReader();
                reader.onload = event => {
                    const base64Image = event.target.result;
                    const previewImg = pasteArea.querySelector('img');
                    previewImg.src = base64Image;
                    previewImg.style.display = 'block';
                    pasteArea.querySelector('p').style.display = 'none';
                    pastedImages[imageId] = base64Image;
                };
                reader.readAsDataURL(item.getAsFile());
            }
        }

        function addEventListenersToSection(sectionElement) {
            sectionElement.querySelectorAll('.paste-area').forEach(area => area.addEventListener('paste', handlePaste));
        }

        function populateMainDropdowns() {
            const adultsSelect = document.getElementById('adultos');
            const ninosSelect = document.getElementById('ninos');
            for (let i = 1; i <= 20; i++) {
                const option = new Option(i, i);
                if (i === 2) option.selected = true;
                adultsSelect.add(option);
            }
            for (let i = 0; i <= 10; i++) {
                const text = i === 0 ? '0' : (i === 1 ? '1 ni침o' : `${i} ni침os`);
                ninosSelect.add(new Option(text, i));
            }
        }

        function initializeForm() {
            form.reset();
            pastedImages = {};
            hotelCounter = 0;
            dynamicComponentsContainer.innerHTML = '';
            document.querySelectorAll('.add-section-btn').forEach(btn => btn.style.display = 'block');
            advisorSelect.innerHTML = '<option value="" disabled selected>Selecciona tu nombre</option>' + Object.keys(ADVISORS).map(id => `<option value="${id}">${ADVISORS[id].name}</option>`).join('');
            advisorSelect.dispatchEvent(new Event('change'));
            populateMainDropdowns();
            const now = new Date();
            document.getElementById('cotizacion-numero').value = `COT-${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}-${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}`;
        }

        advisorSelect.addEventListener('change', () => {
            const selectedAdvisor = ADVISORS[advisorSelect.value];
            if (selectedAdvisor) advisorWhatsappInput.value = selectedAdvisor.defaultWhatsapp;
        });

        function validateForm() {
            if (!form.checkValidity()) {
                form.reportValidity();
                alert('Por favor, completa todos los campos obligatorios.');
                return false;
            }
            if (dynamicComponentsContainer.children.length === 0) {
                alert('Debes a침adir al menos un componente.');
                return false;
            }
            return true;
        }

        const toggleLoader = (show, text = "Generando PDF...") => {
            loaderOverlay.style.display = show ? 'flex' : 'none';
        };

        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' });
        }

        function formatCurrency(value, currency = 'COP') {
            const number = parseFloat(String(value).replace(/[^0-9.-]+/g, ""));
            if (isNaN(number) || !String(value).trim()) return '';
            return number.toLocaleString(currency === 'COP' ? 'es-CO' : 'en-US', { style: 'currency', currency, minimumFractionDigits: currency === 'COP' ? 0 : 2, maximumFractionDigits: currency === 'COP' ? 0 : 2 });
        }

        function populateQuote() {
            const advisorKey = advisorSelect.value;
            const advisor = ADVISORS[advisorKey];
            const advisorWhatsapp = advisorWhatsappInput.value;
            const clientName = document.getElementById('nombre-completo').value;
            const quoteNumber = document.getElementById('cotizacion-numero').value;
            const adults = document.getElementById('adultos').value;
            const children = document.getElementById('ninos').value;

            document.getElementById('confirm-intro-text').textContent = `춰Hola, ${clientName.split(' ')[0].toUpperCase()}! He preparado estas opciones para tu pr칩ximo viaje.`;

            const customerBox = document.getElementById('confirm-customer-data-box');
            customerBox.innerHTML = `<p>Para: <strong>${clientName.toUpperCase()}</strong></p><p>Pasajeros: <strong>${adults} Adulto${adults > 1 ? 's' : ''}${children > 0 ? ` y ${children} Ni침o${children > 1 ? 's' : ''}` : ''}</strong></p><p>N췈 Cotizaci칩n: <strong>${quoteNumber}</strong> | Validez: <strong>${document.getElementById('validez-cupos').value}</strong></p>`;

            document.getElementById('advisor-photo').src = advisor.photoUrl;
            document.getElementById('advisor-name').textContent = advisor.name;

            const whatsappLink = `https://wa.me/${advisorWhatsapp}`;
            const whatsappLinksIds = ['advisor-whatsapp-btn', 'cta-reservar', 'cta-contactar', 'footer-wpp-link'];
            whatsappLinksIds.forEach(id => {
                const el = document.getElementById(id);
                const baseText = id === 'cta-reservar' ? `춰Hola ${advisor.name}! Estoy listo para reservar seg칰n la cotizaci칩n *${quoteNumber}*.` : `Hola ${advisor.name}, tengo una pregunta sobre la cotizaci칩n *${quoteNumber}*.`;
                el.href = `${whatsappLink}?text=${encodeURIComponent(baseText)}`;
            });

            confirmationComponentsContainer.innerHTML = '';

            const hotelForms = document.querySelectorAll('.hotel-form-wrapper');
            hotelForms.forEach((form, index) => {
                const num = form.id.match(/\d+/)[0];
                let galleryHTML = [1, 2, 3].map(i => pastedImages[`hotel-${num}-foto-${i}`] ? `<img src="${pastedImages[`hotel-${num}-foto-${i}`]}">` : '').join('');
                let hotelDetailsHTML = `
                    <div class="data-item">${ICONS.destination}<div class="data-item-content"><strong>Destino:</strong><p>${document.getElementById(`destino-${num}`).value}</p></div></div>
                    <div class="data-item">${ICONS.calendar}<div class="data-item-content"><strong>Fechas:</strong><p>${formatDate(document.getElementById(`fecha-viaje-${num}`).value)}</p></div></div>
                    <div class="data-item">${ICONS.moon}<div class="data-item-content"><strong>Noches:</strong><p>${document.getElementById(`cantidad-noches-${num}`).options[document.getElementById(`cantidad-noches-${num}`).selectedIndex].text}</p></div></div>
                    <div class="data-item">${ICONS.bed}<div class="data-item-content"><strong>Habitaciones:</strong><p>${document.getElementById(`cantidad-habitaciones-${num}`).options[document.getElementById(`cantidad-habitaciones-${num}`).selectedIndex].text}</p></div></div>`;
                
                confirmationComponentsContainer.innerHTML += `
                    <div class="quote-option-box">
                        <div class="option-header"><h3>Hotel ${index + 1}</h3><span class="option-price">${formatCurrency(document.getElementById(`valor-total-${num}`).value, document.getElementById(`moneda-${num}`).value)}</span></div>
                        <div class="option-body">
                            <h4>${document.getElementById(`hotel-${num}`).value}</h4>
                            <div class="photo-gallery">${galleryHTML || '<p>No se a침adieron im치genes.</p>'}</div>
                            <div class="details-grid">
                                ${hotelDetailsHTML}
                                <div class="data-item full-width">${ICONS.check}<div class="data-item-content"><strong>Plan Incluye:</strong><p>${REGIMEN_TEMPLATES[document.getElementById(`regimen-${num}`).value] || 'No especificado'}</p></div></div>
                            </div>
                        </div>
                    </div>`;
            });

            if (document.getElementById('flights-form-wrapper')) {
                const departureCity = document.getElementById('ciudad-salida').value;
                let optionsHTML = [1, 2].map(i => {
                    const wrapper = document.getElementById(`flight-${i}-form-wrapper`);
                    if ((i === 1 || (wrapper && wrapper.style.display !== 'none')) && document.getElementById(`flight-${i}-airline`)) {
                        const airline = document.getElementById(`flight-${i}-airline`).value; const price = document.getElementById(`flight-${i}-price`).value;
                        if (airline && price) return `<div class="item-option"><strong>Opci칩n ${i}:</strong> ${airline} <span class="item-price">Desde ${formatCurrency(price)}</span></div>`;
                    } return '';
                }).join('');
                confirmationComponentsContainer.innerHTML += `<div class="component-section"><h3>Vuelos Sugeridos</h3>${pastedImages['flight-banner-preview'] ? `<div class="flight-banner"><img src="${pastedImages['flight-banner-preview']}"></div>` : ''}<div id="flight-options-confirm-container"><div class="data-item">${ICONS.plane}<div class="data-item-content"><strong>Desde:</strong><p>${departureCity}</p></div></div>${optionsHTML}</div><p class="item-disclaimer">*Valores por persona, sujetos a cambio.</p></div>`;
            }

            ['tours', 'transfers'].forEach(type => {
                if (document.getElementById(`${type}-form-wrapper`)) {
                    const imgHTML = pastedImages[`${type.slice(0, -1)}-main-photo`] ? `<div class="single-photo-container"><img src="${pastedImages[`${type.slice(0, -1)}-main-photo`]}"></div>` : '';
                    const nameKey = type === 'tours' ? 'name' : 'desc';
                    const desc = document.getElementById(`${type.slice(0, -1)}-1-${nameKey}`).value; const price = document.getElementById(`${type.slice(0, -1)}-1-price`).value;
                    confirmationComponentsContainer.innerHTML += `<div class="component-section"><h3>${type === 'tours' ? 'Tours Opcionales' : 'Traslados'}</h3><div class="option-body">${imgHTML}<div class="item-option">${desc}<span class="item-price">Desde ${formatCurrency(price)}</span></div></div></div>`;
                }
            });

            document.getElementById('confirm-pago-reserva').textContent = formatCurrency(document.getElementById('pago-reserva').value);
            document.getElementById('confirm-pago-segundo').textContent = formatCurrency(document.getElementById('pago-segundo').value);
            document.getElementById('confirm-fecha-limite').textContent = document.getElementById('fecha-limite-pago').value;
            document.getElementById('confirm-no-incluye').textContent = document.getElementById('no-incluye').value;

            let termsHTML = '';
            if (document.querySelector('.hotel-form-wrapper')) termsHTML += TERMS_AND_CONDITIONS.hotels;
            if (document.getElementById('flights-form-wrapper')) termsHTML += TERMS_AND_CONDITIONS.flights;
            if (document.getElementById('transfers-form-wrapper')) termsHTML += TERMS_AND_CONDITIONS.transfers;
            
            const termsContainer = document.getElementById('terms-section-confirm');
            if (termsHTML) {
                document.getElementById('confirm-terms-content').innerHTML = termsHTML;
                termsContainer.style.display = 'block';
            } else {
                termsContainer.style.display = 'none';
            }
        }

        async function processQuote() {
            toggleLoader(true, "Generando PDF...");
            processQuoteBtn.disabled = true;
            try {
                const elementToPrint = document.getElementById('voucher-to-print');
                const canvas = await html2canvas(elementToPrint, { scale: 2, useCORS: true, logging: true });
                const pdf = new window.jspdf.jsPDF({ orientation: 'p', unit: 'px', format: [canvas.width, canvas.height] });
                pdf.addImage(canvas.toDataURL('image/jpeg', 0.95), 'JPEG', 0, 0, canvas.width, canvas.height);
                
                const scaleFactor = canvas.width / elementToPrint.offsetWidth;
                ['advisor-whatsapp-btn', 'cta-reservar', 'cta-contactar', 'footer-wpp-link'].forEach(id => {
                    const element = document.getElementById(id); if (!element || !element.href) return;
                    const rect = element.getBoundingClientRect(); const containerRect = elementToPrint.getBoundingClientRect();
                    pdf.link((rect.left - containerRect.left) * scaleFactor, (rect.top - containerRect.top) * scaleFactor, rect.width * scaleFactor, rect.height * scaleFactor, { url: element.href });
                });
                
                pdf.save(`Cotizacion_${document.getElementById('cotizacion-numero').value}_${document.getElementById('nombre-completo').value.replace(/ /g, '_')}.pdf`);
                alert("춰칄XITO!\n\nLa cotizaci칩n ha sido generada y descargada.");
            } catch (error) { console.error("Error en el proceso:", error); alert(`Hubo un error: ${error.message}`); } 
            finally { toggleLoader(false); processQuoteBtn.disabled = false; }
        }

        form.addEventListener('submit', e => { e.preventDefault(); if (!validateForm()) return; populateQuote(); formTitleSection.style.display = 'none'; formSection.style.display = 'none'; confirmationSection.style.display = 'block'; window.scrollTo(0, 0); });
        processQuoteBtn.addEventListener('click', processQuote);
        newQuoteBtn.addEventListener('click', () => { confirmationSection.style.display = 'none'; formTitleSection.style.display = 'block'; formSection.style.display = 'block'; initializeForm(); window.scrollTo(0, 0); });
        
        initializeForm();
    }

    // --- MANEJADOR DEL LOGIN ---
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        if (passwordInput.value === ACCESS_PASSWORD) {
            loginOverlay.style.display = 'none';
            mainWrapper.style.display = 'block';
            initializeApp(); // Inicia la aplicaci칩n solo si la contrase침a es correcta
        } else {
            loginError.style.display = 'block';
            passwordInput.value = '';
        }
    });

});
